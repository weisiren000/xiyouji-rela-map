<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>三维银河系像素方块可视化</title>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            overflow: hidden;
            background: linear-gradient(135deg, #0b0b2b, #000000);
            color: #fff;
            font-family: 'Arial', sans-serif;
            height: 100vh;
            perspective: 1000px;
        }
        
        #container {
            position: relative;
            width: 100%;
            height: 100vh;
        }
        
        #canvas-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .header {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            z-index: 10;
            text-align: center;
            background: rgba(0, 0, 20, 0.5);
            backdrop-filter: blur(5px);
            border-bottom: 1px solid rgba(100, 100, 255, 0.3);
        }
        
        h1 {
            font-size: 2.5rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #4d79ff;
            background: linear-gradient(to right, #4facfe, #00f2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.8;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 5, 30, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(100, 100, 255, 0.3);
            z-index: 10;
        }
        
        .controls p {
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: #a0b0ff;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            text-align: center;
            z-index: 20;
            color: #4facfe;
        }
        
        .stats {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 5, 30, 0.7);
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            border: 1px solid rgba(100, 100, 255, 0.3);
            z-index: 10;
        }
        
        .galaxy-center {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, #ffff00, #ff9900);
            border-radius: 50%;
            box-shadow: 0 0 30px #ff9900, 0 0 60px #ffff0080;
            transform: translate(-50%, -50%);
            z-index: 5;
        }
        
        .toggle {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 5, 30, 0.7);
            padding: 10px 15px;
            border-radius: 10px;
            border: 1px solid rgba(100, 100, 255, 0.3);
            z-index: 10;
            cursor: pointer;
            transition: all 0.3s;
            color: #a0b0ff;
            font-weight: bold;
        }
        
        .toggle:hover {
            background: rgba(20, 30, 80, 0.7);
        }
        
        .info-panel {
            position: absolute;
            bottom: 80px;
            left: 20px;
            background: rgba(0, 5, 30, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(100, 100, 255, 0.3);
            z-index: 10;
            max-width: 300px;
        }
        
        .info-panel h3 {
            margin-bottom: 10px;
            color: #4facfe;
        }
        
        .info-panel p {
            font-size: 0.9rem;
            line-height: 1.5;
            color: #a0b0ff;
            margin-bottom: 8px;
        }
        
        .progress-bar {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            height: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            overflow: hidden;
            z-index: 25;
        }
        
        .progress {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #00f2fe, #4facfe);
            border-radius: 5px;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div id="container">
        <div class="header">
            <h1>三维银河系像素方块可视化</h1>
            <p class="subtitle">使用立方体像素展示银河系结构，包含中心密集区域和四条旋臂</p>
        </div>
        
        <div id="canvas-container"></div>
        <div class="galaxy-center"></div>
        
        <div class="controls">
            <p>鼠标拖拽 = 旋转视角</p>
            <p>鼠标滚轮 = 缩放</p>
            <p>右键拖拽 = 平移</p>
        </div>
        
        <div class="info-panel">
            <h3>银河系结构</h3>
            <p>• 中央核球：密集的黄色恒星群</p>
            <p>• 四条旋臂：蓝紫色立方体代表恒星系统</p>
            <p>• 星系晕：外围的稀疏恒星</p>
        </div>
        
        <div class="stats">
            <p>立方体数量: <span id="cube-count">8,000</span></p>
            <p>星系半径: <span id="galaxy-radius">80,000 光年</span></p>
        </div>
        
        <div class="toggle" id="toggle-motion">暂停运动</div>
        
        <div class="loading">正在生成银河系...</div>
        <div class="progress-bar"><div class="progress" id="progress"></div></div>
    </div>

    <script>
        // 全局变量
        let scene, camera, renderer, controls;
        let galaxyGroup;
        let spiralCubes = [];
        let animate = true;
        let progress = 0;
        
        // 当页面加载完成后初始化
        window.addEventListener('load', function() {
            // 初始化3D场景
            initThreeJS();
        });
        
        // 更新进度条
        function updateProgress(value) {
            const progressBar = document.getElementById('progress');
            progressBar.style.width = `${value}%`;
        }
        
        // 初始化Three.js场景
        function initThreeJS() {
            // 创建场景
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000022);
            scene.fog = new THREE.Fog(0x000022, 100, 300);
            
            // 创建相机
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 40, 80);
            
            // 创建渲染器
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            
            // 添加轨道控制
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.rotateSpeed = 0.5;
            
            // 添加光源
            const ambientLight = new THREE.AmbientLight(0x333366);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(5, 10, 7);
            scene.add(directionalLight);
            
            // 创建点光源作为星系中心
            const centerLight = new THREE.PointLight(0xffcc00, 2, 50);
            centerLight.position.set(0, 0, 0);
            scene.add(centerLight);
            
            // 创建银河系
            createGalaxy();
            
            // 添加暂停/继续按钮事件
            const toggleBtn = document.getElementById('toggle-motion');
            toggleBtn.addEventListener('click', function() {
                animate = !animate;
                toggleBtn.textContent = animate ? '暂停运动' : '开始运动';
            });
            
            // 渲染循环
            function animateScene() {
                requestAnimationFrame(animateScene);
                
                if (animate) {
                    // 旋转整个银河系
                    galaxyGroup.rotation.y += 0.002;
                    
                    // 更新旋臂动画
                    updateSpiralArms();
                }
                
                controls.update();
                renderer.render(scene, camera);
            }
            
            animateScene();
            
            // 窗口大小调整
            window.addEventListener('resize', function() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }
        
        // 创建银河系
        function createGalaxy() {
            galaxyGroup = new THREE.Group();
            scene.add(galaxyGroup);
            
            // 创建中央球状区域
            createGalacticCenter();
            updateProgress(30);
            
            // 创建四条旋臂
            createSpiralArms();
            updateProgress(70);
            
            // 创建星系晕（外围稀疏恒星）
            createGalacticHalo();
            updateProgress(100);
            
            // 移除加载提示
            setTimeout(() => {
                document.querySelector('.loading').style.display = 'none';
                document.querySelector('.progress-bar').style.display = 'none';
            }, 500);
        }
        
        // 创建星系中心
        function createGalacticCenter() {
            // 创建星系核心
            const centerGeometry = new THREE.SphereGeometry(8, 32, 32);
            const centerMaterial = new THREE.MeshPhongMaterial({ 
                color: 0xffcc00,
                emissive: 0xffaa00,
                emissiveIntensity: 0.8
            });
            const center = new THREE.Mesh(centerGeometry, centerMaterial);
            galaxyGroup.add(center);
            
            // 添加中心周围的立方体像素
            const cubeCount = 2000;
            const cubeSize = 0.6;
            const cubeGeometry = new THREE.BoxGeometry(cubeSize, cubeSize, cubeSize);
            
            for (let i = 0; i < cubeCount; i++) {
                // 球坐标系分布
                const phi = Math.random() * Math.PI * 2;
                const theta = Math.random() * Math.PI;
                const radius = Math.random() * 6 + 4; // 4-10距离
                
                // 转换为笛卡尔坐标
                const x = radius * Math.sin(theta) * Math.cos(phi);
                const y = radius * Math.cos(theta);
                const z = radius * Math.sin(theta) * Math.sin(phi);
                
                // 创建立方体
                const cubeMaterial = new THREE.MeshPhongMaterial({
                    color: new THREE.Color().setHSL(0.12, 0.9, 0.6), // 黄色调
                    emissive: new THREE.Color().setHSL(0.12, 0.8, 0.2),
                    shininess: 30
                });
                
                const cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
                cube.position.set(x, y, z);
                
                // 随机旋转立方体
                cube.rotation.set(
                    Math.random() * Math.PI,
                    Math.random() * Math.PI,
                    Math.random() * Math.PI
                );
                
                galaxyGroup.add(cube);
            }
        }
        
        // 创建螺旋臂
        function createSpiralArms() {
            const armCount = 4; // 四条旋臂
            const cubesPerArm = 1500; // 每条臂1500个立方体
            const cubeSize = 0.5;
            const cubeGeometry = new THREE.BoxGeometry(cubeSize, cubeSize, cubeSize);
            
            for (let arm = 0; arm < armCount; arm++) {
                const armAngle = (arm / armCount) * Math.PI * 2;
                
                for (let i = 0; i < cubesPerArm; i++) {
                    // 使用对数螺旋线方程：r = a * e^(bθ)
                    const angle = armAngle + (i / 100);
                    const distance = 10 + (i / cubesPerArm) * 70; // 10-80的距离
                    
                    // 添加随机偏移使旋臂更自然
                    const offset = (Math.random() - 0.5) * 5;
                    const x = Math.cos(angle) * (distance + offset);
                    const z = Math.sin(angle) * (distance + offset);
                    const y = (Math.random() - 0.5) * 4;
                    
                    // 创建立方体
                    const hue = 0.7 + Math.random() * 0.2; // 蓝色到紫色
                    const cubeMaterial = new THREE.MeshPhongMaterial({
                        color: new THREE.Color().setHSL(hue, 0.8, 0.6),
                        emissive: new THREE.Color().setHSL(hue, 0.8, 0.2),
                        shininess: 30
                    });
                    
                    const cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
                    cube.position.set(x, y, z);
                    
                    // 随机旋转立方体
                    cube.rotation.set(
                        Math.random() * Math.PI,
                        Math.random() * Math.PI,
                        Math.random() * Math.PI
                    );
                    
                    // 保存立方体引用用于动画
                    spiralCubes.push({
                        mesh: cube,
                        originalY: y,
                        timeOffset: Math.random() * Math.PI * 2
                    });
                    
                    galaxyGroup.add(cube);
                }
            }
        }
        
        // 创建星系晕（外围稀疏恒星）
        function createGalacticHalo() {
            const starCount = 1000;
            const starGeometry = new THREE.SphereGeometry(0.2, 8, 8);
            
            for (let i = 0; i < starCount; i++) {
                // 球坐标系分布
                const phi = Math.random() * Math.PI * 2;
                const theta = Math.random() * Math.PI;
                const radius = 80 + Math.random() * 40; // 80-120距离
                
                // 转换为笛卡尔坐标
                const x = radius * Math.sin(theta) * Math.cos(phi);
                const y = radius * Math.cos(theta);
                const z = radius * Math.sin(theta) * Math.sin(phi);
                
                // 创建星星
                const starMaterial = new THREE.MeshPhongMaterial({
                    color: 0xffffff,
                    emissive: 0xaaaaaa,
                    emissiveIntensity: 0.3
                });
                
                const star = new THREE.Mesh(starGeometry, starMaterial);
                star.position.set(x, y, z);
                
                galaxyGroup.add(star);
            }
        }
        
        // 更新旋臂动画
        function updateSpiralArms() {
            const time = Date.now() * 0.001;
            
            for (let i = 0; i < spiralCubes.length; i++) {
                const cubeData = spiralCubes[i];
                const cube = cubeData.mesh;
                
                // 上下浮动效果
                cube.position.y = cubeData.originalY + Math.sin(time * 0.5 + cubeData.timeOffset) * 0.5;
                
                // 轻微旋转效果
                cube.rotation.x += 0.003;
                cube.rotation.y += 0.004;
            }
        }
    </script>
</body>
</html>