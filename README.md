# è¥¿æ¸¸è®°å…³ç³»å›¾è°± - åç«¯APIæœåŠ¡

## ğŸ“– é¡¹ç›®ç®€ä»‹

è¿™æ˜¯è¥¿æ¸¸è®°è§’è‰²å…³ç³»3Då¯è§†åŒ–é¡¹ç›®çš„åç«¯APIæœåŠ¡ï¼Œæä¾›è§’è‰²æ•°æ®ã€äº‹ä»¶æ•°æ®å’Œç»Ÿè®¡ä¿¡æ¯çš„RESTful APIæ¥å£ã€‚

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **è¿è¡Œæ—¶**: Node.js 18+
- **æ¡†æ¶**: Express.js
- **æ•°æ®åº“**: SQLite (better-sqlite3)
- **è·¨åŸŸ**: CORS
- **å¼€å‘å·¥å…·**: Nodemon

## ğŸ“ é¡¹ç›®ç»“æ„

```
xiyouji-rela-map-backend/
â”œâ”€â”€ data/                    # æ•°æ®åº“æ–‡ä»¶
â”‚   â”œâ”€â”€ characters.db       # è§’è‰²æ•°æ®åº“
â”‚   â”œâ”€â”€ events.db          # äº‹ä»¶æ•°æ®åº“
â”‚   â””â”€â”€ backup/            # æ•°æ®å¤‡ä»½
â”œâ”€â”€ dataServer.js          # ä¸»æœåŠ¡å™¨æ–‡ä»¶
â”œâ”€â”€ current-server.js      # å½“å‰æœåŠ¡å™¨å®ä¾‹
â”œâ”€â”€ test.js               # APIæµ‹è¯•è„šæœ¬
â”œâ”€â”€ package.json          # é¡¹ç›®é…ç½®
â””â”€â”€ README.md            # é¡¹ç›®æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–
```bash
npm install
# æˆ–
pnpm install
```

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
npm run dev
# æˆ–
pnpm run dev
```

### å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
```bash
npm start
# æˆ–
pnpm start
```

## ğŸ“¡ APIæ¥å£

### åŸºç¡€URL
- å¼€å‘ç¯å¢ƒ: `http://localhost:3003/api`
- ç”Ÿäº§ç¯å¢ƒ: æ ¹æ®éƒ¨ç½²å¹³å°è€Œå®š

### è§’è‰²ç›¸å…³æ¥å£

#### è·å–æ‰€æœ‰è§’è‰²
```
GET /api/characters
```

#### è·å–æ‰€æœ‰åˆ«å
```
GET /api/aliases
```

#### è·å–å®Œæ•´æ•°æ®
```
GET /api/data/complete
```
è¿”å›è§’è‰²ã€åˆ«åå’Œç»Ÿè®¡æ•°æ®çš„å®Œæ•´é›†åˆã€‚

### äº‹ä»¶ç›¸å…³æ¥å£

#### è·å–æ‰€æœ‰äº‹ä»¶
```
GET /api/events
```

#### æ ¹æ®IDè·å–äº‹ä»¶
```
GET /api/events?id={eventId}
```

#### æœç´¢äº‹ä»¶
```
GET /api/events?search={keyword}
```

### ç»Ÿè®¡æ¥å£

#### è·å–æ•°æ®ç»Ÿè®¡
```
GET /api/stats
```

## ğŸ—„ï¸ æ•°æ®åº“ç»“æ„

### charactersè¡¨
- `id`: è§’è‰²ID
- `name`: è§’è‰²åç§°
- `type`: è§’è‰²ç±»å‹ï¼ˆä¸»è§’ã€ç¥ä»™ã€å¦–é­”ç­‰ï¼‰
- `description`: è§’è‰²æè¿°
- `power_level`: æˆ˜åŠ›ç­‰çº§
- `realm`: æ‰€å±å¢ƒç•Œ
- `weapon`: æ­¦å™¨
- `skills`: æŠ€èƒ½åˆ—è¡¨ï¼ˆJSONï¼‰
- `relationships`: å…³ç³»åˆ—è¡¨ï¼ˆJSONï¼‰
- `appearances`: å‡ºåœºä¿¡æ¯ï¼ˆJSONï¼‰

### eventsè¡¨
- `id`: äº‹ä»¶ID
- `title`: äº‹ä»¶æ ‡é¢˜
- `description`: äº‹ä»¶æè¿°
- `location`: å‘ç”Ÿåœ°ç‚¹
- `characters_involved`: æ¶‰åŠè§’è‰²ï¼ˆJSONï¼‰
- `difficulty_level`: éš¾åº¦ç­‰çº§
- `moral_lesson`: å¯“æ„æ•™è®­
- `sequence_number`: åºå·ï¼ˆ1-81ï¼‰

## ğŸ”§ é…ç½®è¯´æ˜

### ç«¯å£é…ç½®
é»˜è®¤ç«¯å£: `3003`
å¯é€šè¿‡ç¯å¢ƒå˜é‡ `PORT` ä¿®æ”¹

### æ•°æ®åº“é…ç½®
- æ•°æ®åº“æ–‡ä»¶ä½äº `data/` ç›®å½•
- ä½¿ç”¨SQLiteï¼Œæ”¯æŒå¹¶å‘è¯»å–
- è‡ªåŠ¨å¤‡ä»½æœºåˆ¶

## ğŸš€ éƒ¨ç½²æŒ‡å—

### Railwayéƒ¨ç½²
1. è¿æ¥GitHubä»“åº“
2. è®¾ç½®å¯åŠ¨å‘½ä»¤: `npm start`
3. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆå¦‚éœ€è¦ï¼‰

### Renderéƒ¨ç½²
1. è¿æ¥GitHubä»“åº“
2. è®¾ç½®æ„å»ºå‘½ä»¤: `npm install`
3. è®¾ç½®å¯åŠ¨å‘½ä»¤: `npm start`

### Verceléƒ¨ç½²
1. å®‰è£…Vercel CLI: `npm i -g vercel`
2. è¿è¡Œ: `vercel`
3. æŒ‰æç¤ºå®Œæˆéƒ¨ç½²

## ğŸ§ª æµ‹è¯•

### è¿è¡ŒAPIæµ‹è¯•
```bash
npm test
# æˆ–
node test.js
```

### æ‰‹åŠ¨æµ‹è¯•
```bash
# æµ‹è¯•æœåŠ¡å™¨çŠ¶æ€
curl http://localhost:3003/api/stats

# æµ‹è¯•è§’è‰²æ•°æ®
curl http://localhost:3003/api/characters
```

## ğŸ“ å¼€å‘è¯´æ˜

### æ·»åŠ æ–°çš„APIç«¯ç‚¹
1. åœ¨ `dataServer.js` ä¸­æ·»åŠ è·¯ç”±
2. å®ç°å¯¹åº”çš„æ•°æ®åº“æŸ¥è¯¢é€»è¾‘
3. æ·»åŠ é”™è¯¯å¤„ç†å’Œå“åº”æ ¼å¼åŒ–
4. æ›´æ–°APIæ–‡æ¡£

### æ•°æ®åº“ç»´æŠ¤
- å®šæœŸå¤‡ä»½æ•°æ®åº“æ–‡ä»¶
- ç›‘æ§æ•°æ®åº“æ€§èƒ½
- å¿…è¦æ—¶è¿›è¡Œæ•°æ®æ¸…ç†å’Œä¼˜åŒ–

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ”— ç›¸å…³é“¾æ¥

- [å‰ç«¯ä»“åº“](https://github.com/weisiren/xiyouji-rela-map-frontend)
- [é¡¹ç›®æ–‡æ¡£](https://github.com/weisiren/xiyouji-rela-map-frontend/docs)
- [åœ¨çº¿æ¼”ç¤º](https://xiyouji-rela-map.vercel.app)

## ğŸ“ è”ç³»æ–¹å¼

- ä½œè€…: weisiren
- é‚®ç®±: [ä½ çš„é‚®ç®±]
- GitHub: [@weisiren](https://github.com/weisiren)
