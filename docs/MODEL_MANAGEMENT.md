# 模型管理系统使用指南

## 概述

本系统提供了自动化的3D模型检测和管理功能，无需手动维护模型列表。

## 功能特性

### 🔍 自动模型检测
- **动态索引加载**：从 `/models/index.json` 自动加载模型列表
- **备用检测机制**：索引文件不可用时使用备用方案
- **实时验证**：检查模型文件是否真实存在
- **智能匹配**：支持名称、拼音、别名多种匹配策略

### 📁 模型目录结构
```
public/models/
├── index.json          # 自动生成的模型索引文件
├── 唐僧.glb
├── 太上老君.glb
├── 如来佛祖.glb
├── 孙悟空.glb
├── 沙僧.glb
├── 牛魔王.glb
├── 猪八戒.glb
├── 白龙马.glb
└── 观音菩萨.glb
```

## 使用方法

### 1. 添加新模型
1. 将 `.glb` 文件放入 `public/models/` 目录
2. 运行索引生成命令：
   ```bash
   npm run models:index
   ```
3. 刷新浏览器，新模型会自动被检测到

### 2. 批量管理模型
```bash
# 扫描并生成模型索引
npm run models:scan

# 监控目录变化（开发模式）
npm run models:watch
```

### 3. 开发模式监控
在开发过程中，可以启动文件监控：
```bash
npm run models:watch
```
这会：
- 监控 `public/models/` 目录的变化
- 自动检测新增、删除、修改的 `.glb` 文件
- 实时更新索引文件

## 索引文件格式

`public/models/index.json` 的结构：
```json
{
  "models": [
    "唐僧.glb",
    "太上老君.glb",
    "如来佛祖.glb",
    "孙悟空.glb",
    "沙僧.glb",
    "牛魔王.glb",
    "猪八戒.glb",
    "白龙马.glb",
    "观音菩萨.glb"
  ],
  "lastUpdated": "2025-06-18T20:32:53.958Z",
  "count": 9,
  "generatedBy": "generate-model-index.js",
  "description": "自动生成的模型文件索引"
}
```

## 模型匹配策略

系统使用多层次匹配算法：

### 1. 名称匹配（置信度：1.0）
- 直接匹配角色名称与模型文件名
- 例：`孙悟空.glb` ↔ 角色名称 "孙悟空"

### 2. 拼音匹配（置信度：0.9）
- 使用角色的拼音字段匹配
- 例：`sun_wu_kong.glb` ↔ 角色拼音 "sun_wu_kong"

### 3. 别名匹配（置信度：0.8）
- 遍历角色的所有别名
- 例：`齐天大圣.glb` ↔ 角色别名 "齐天大圣"

## 故障排除

### 问题1：新模型未被检测到
**解决方案：**
1. 确认模型文件在 `public/models/` 目录中
2. 运行 `npm run models:index` 重新生成索引
3. 检查浏览器控制台的日志信息

### 问题2：索引文件加载失败
**解决方案：**
1. 检查 `public/models/index.json` 文件是否存在
2. 验证JSON格式是否正确
3. 系统会自动使用备用检测机制

### 问题3：模型文件存在但无法加载
**解决方案：**
1. 检查文件权限和路径
2. 确认文件格式为有效的 `.glb` 文件
3. 查看网络请求是否成功

## 开发者信息

### 相关文件
- `scripts/generate-model-index.js` - 索引生成脚本
- `scripts/watch-models.js` - 目录监控脚本
- `src/hooks/useBatchModelDetection.ts` - 批量检测Hook
- `src/hooks/useSmartModelDetection.ts` - 智能检测Hook

### 扩展功能
- **模型预览**：可添加缩略图生成
- **元数据管理**：可扩展模型信息（大小、创建时间等）
- **版本控制**：可添加模型版本管理
- **云存储集成**：可集成云端模型库

## 最佳实践

1. **命名规范**：使用角色的标准名称命名模型文件
2. **定期维护**：定期运行 `npm run models:index` 确保索引最新
3. **开发监控**：开发时使用 `npm run models:watch` 提高效率
4. **备份管理**：重要模型文件建议进行版本控制

## 性能优化

- **缓存机制**：检测结果会被缓存，避免重复计算
- **批量处理**：一次性检测所有模型，提高效率
- **按需加载**：仅在需要时进行模型验证
- **错误处理**：优雅处理文件不存在等异常情况
