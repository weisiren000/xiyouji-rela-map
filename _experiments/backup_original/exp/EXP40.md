# EXP40 - çœŸå®JSONæ•°æ®åŠ è½½ç³»ç»Ÿå®ç°

## å®éªŒæ—¶é—´
2025å¹´1æœˆ8æ—¥

## å®éªŒèƒŒæ™¯
ç”¨æˆ·éœ€è¦åŠ è½½å®é™…çš„JSONæ•°æ®(`D:\codee\xiyouji-rela-map\docs\data\JSON`)æ›¿æ¢éšæœºç”Ÿæˆçš„æ˜Ÿçƒï¼Œè¦æ±‚ç”¨åç«¯ç¨‹åºè¯»å–è§£ææ•°æ®ï¼Œå†é€šè¿‡åç«¯ä¸å‰ç«¯é€šè®¯åŠ è½½å‘ˆç°ã€‚

## ç¬¬ä¸€æ€§åŸç†åˆ†æ

### æ ¸å¿ƒéœ€æ±‚
- **çœŸå®æ•°æ®**: åŠ è½½247ä¸ªå®é™…çš„è¥¿æ¸¸è®°è§’è‰²JSONæ–‡ä»¶
- **åç«¯å¤„ç†**: ä½¿ç”¨Node.jsæœåŠ¡å™¨è¯»å–å’Œè§£æJSONæ•°æ®
- **å‰åç«¯é€šä¿¡**: é€šè¿‡RESTful APIè¿›è¡Œæ•°æ®ä¼ è¾“
- **æ•°æ®è½¬æ¢**: å°†JSONæ•°æ®è½¬æ¢ä¸º3Då¯è§†åŒ–æ ¼å¼

### æŠ€æœ¯æ¶æ„
é‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼š
- **åç«¯**: Node.js + Express æ•°æ®æœåŠ¡å™¨
- **å‰ç«¯**: React + TypeScript å¯è§†åŒ–ç•Œé¢
- **é€šä¿¡**: RESTful API + JSONæ•°æ®æ ¼å¼
- **æ•°æ®**: 149ä¸ªè§’è‰² + 97ä¸ªåˆ«åJSONæ–‡ä»¶

## æ•°æ®ç»“æ„åˆ†æ

### JSONæ–‡ä»¶ç»“æ„
é€šè¿‡åˆ†æå®é™…æ–‡ä»¶å‘ç°æ ‡å‡†æ ¼å¼ï¼š

**è§’è‰²æ–‡ä»¶** (`character_c0001_sunwukong.json`):
```json
{
  "unid": "c0001",
  "isAlias": false,
  "basic": {
    "name": "å­™æ‚Ÿç©º",
    "pinyin": "sun_wu_kong", 
    "aliases": ["ç¾çŒ´ç‹", "é½å¤©å¤§åœ£", ...],
    "type": "character",
    "category": "protagonist"
  },
  "attributes": {
    "level": { "id": "da_luo_jin_xian", "name": "å¤§ç½—é‡‘ä»™", "tier": 8 },
    "rank": 1,
    "power": 95,
    "influence": 90,
    "morality": "neutral_good"
  },
  "metadata": {
    "description": "èŠ±æœå±±ç¾çŒ´ç‹...",
    "tags": ["protagonist", "immortal", ...],
    "sourceChapters": [1, 2, 3, ...],
    "firstAppearance": 1
  }
}
```

**åˆ«åæ–‡ä»¶** (`character_alias_ca0001_meihouwang.json`):
```json
{
  "unid": "ca0001",
  "isAlias": true,
  "aliasOf": "c0001",
  "basic": { "name": "ç¾çŒ´ç‹", ... },
  "metadata": {
    "aliasType": "title",
    "aliasContext": "èŠ±æœå±±ç§°ç‹æ—¶æœŸçš„æ­£å¼ç§°å·"
  }
}
```

## åç«¯å®ç°

### 1. æ•°æ®æœåŠ¡å™¨ (`src/server/dataServer.js`)

**æ ¸å¿ƒåŠŸèƒ½**:
- æ–‡ä»¶ç³»ç»Ÿæ‰«æå’Œè¯»å–
- JSONæ•°æ®è§£æå’ŒéªŒè¯
- æ•°æ®æ ¼å¼è½¬æ¢å’Œæ˜ å°„
- RESTful APIæ¥å£æä¾›
- æ•°æ®ç¼“å­˜å’Œæ€§èƒ½ä¼˜åŒ–

**APIç«¯ç‚¹**:
- `GET /api/characters` - è·å–æ‰€æœ‰è§’è‰²æ•°æ®
- `GET /api/aliases` - è·å–æ‰€æœ‰åˆ«åæ•°æ®
- `GET /api/data/complete` - è·å–å®Œæ•´æ•°æ®é›†
- `GET /api/stats` - è·å–æ•°æ®ç»Ÿè®¡ä¿¡æ¯
- `POST /api/cache/refresh` - åˆ·æ–°æ•°æ®ç¼“å­˜

### 2. æ•°æ®è½¬æ¢é€»è¾‘

**ç±»å‹æ˜ å°„**:
```javascript
const typeMap = {
  'protagonist': 'PROTAGONIST',  // ä¸»è§’å›¢é˜Ÿ
  'deity': 'DEITY',             // ç¥ä»™
  'demon': 'DEMON',             // å¦–é­”
  'human': 'HUMAN',             // äººç±»
  'dragon': 'DRAGON',           // é¾™æ—
  'celestial': 'CELESTIAL',     // å¤©åº­
  'buddhist': 'BUDDHIST',       // ä½›æ•™
  'underworld': 'UNDERWORLD'    // åœ°åºœ
}
```

**å¯è§†åŒ–é…ç½®ç”Ÿæˆ**:
```javascript
function generateVisualConfig(rawData) {
  const rank = rawData.attributes.rank
  const power = rawData.attributes.power || 50
  const category = rawData.basic.category
  
  // åŸºäºç±»å‹çš„é¢œè‰²æ˜ å°„
  const colorMap = {
    'protagonist': '#FFD700',    // é‡‘è‰²
    'deity': '#87CEEB',          // å¤©è“è‰²
    'demon': '#FF6347',          // çº¢è‰²
    'dragon': '#00CED1',         // é’è‰²
    'buddhist': '#DDA0DD',       // ç´«è‰²
    'celestial': '#F0E68C',      // å¡å…¶è‰²
    'underworld': '#696969',     // ç°è‰²
    'human': '#FFA500'           // æ©™è‰²
  }
  
  // åŸºäºæ’åçš„å¤§å° (é‡è¦è§’è‰²æ›´å¤§)
  const size = Math.max(0.5, 2.0 - (rank / 150) * 1.5)
  
  // åŸºäºèƒ½åŠ›çš„å‘å…‰å¼ºåº¦
  const emissiveIntensity = Math.max(0.1, Math.min(1.0, power / 100 * 0.8))
  
  return { color: colorMap[category], size, emissiveIntensity }
}
```

## å‰ç«¯å®ç°

### 1. APIå®¢æˆ·ç«¯ (`src/services/dataApi.ts`)

**DataApiç±»**:
- `getCharacters()` - è·å–è§’è‰²æ•°æ®
- `getCompleteData()` - è·å–å®Œæ•´æ•°æ®
- `checkConnection()` - æ£€æŸ¥æœåŠ¡å™¨è¿æ¥
- `refreshCache()` - åˆ·æ–°ç¼“å­˜

**DataTransformerç±»**:
- `transformToGalaxyData()` - è½¬æ¢ä¸ºé“¶æ²³ç³»æ•°æ®
- `calculatePosition()` - è®¡ç®—3Dä½ç½®
- `generateRelationships()` - ç”Ÿæˆå…³ç³»è¿çº¿

### 2. Dashboardé›†æˆ

æ›´æ–°äº†DataLoaderç»„ä»¶ï¼š
- æœåŠ¡å™¨è¿æ¥æ£€æŸ¥
- çœŸå®APIè°ƒç”¨
- è¿›åº¦æ˜¾ç¤ºå’Œé”™è¯¯å¤„ç†
- æ•°æ®ç»Ÿè®¡å±•ç¤º

## æµ‹è¯•éªŒè¯

### 1. æ•°æ®è·¯å¾„æµ‹è¯•
```
âœ… ä¸»æ•°æ®ç›®å½•å­˜åœ¨: D:\codee\xiyouji-rela-map\docs\data\JSON
âœ… è§’è‰²ç›®å½•å­˜åœ¨: D:\codee\xiyouji-rela-map\docs\data\JSON\character  
âœ… åˆ«åç›®å½•å­˜åœ¨: D:\codee\xiyouji-rela-map\docs\data\JSON\character_alias
```

### 2. æ–‡ä»¶æ‰«ææµ‹è¯•
```
âœ… æ‰¾åˆ° 150 ä¸ªè§’è‰²æ–‡ä»¶
âœ… æ‰¾åˆ° 97 ä¸ªåˆ«åæ–‡ä»¶
```

### 3. æ•°æ®è¯»å–æµ‹è¯•
```
âœ… æˆåŠŸè¯»å–è§’è‰²æ–‡ä»¶: character_c0001_sunwukong.json
   è§’è‰²åç§°: å­™æ‚Ÿç©º
   è§’è‰²ID: c0001
   è§’è‰²ç±»å‹: protagonist
   æ’å: 1
```

### 4. APIæµ‹è¯•
```
âœ… æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ: http://localhost:3001
âœ… APIç»Ÿè®¡æ¥å£æ­£å¸¸: 149ä¸ªè§’è‰²æ•°æ®
âœ… APIè§’è‰²æ¥å£æ­£å¸¸: å®Œæ•´è§’è‰²ä¿¡æ¯
```

## æ•°æ®ç»Ÿè®¡ç»“æœ

### è§’è‰²åˆ†å¸ƒ
- **æ€»è§’è‰²æ•°**: 149ä¸ª
- **æ€»åˆ«åæ•°**: 97ä¸ª
- **ä¸»è§’å›¢é˜Ÿ**: 5ä¸ª (å­™æ‚Ÿç©ºã€å”åƒ§ã€çŒªå…«æˆ’ã€æ²™åƒ§ã€ç™½é¾™é©¬)
- **ç¥ä»™**: 80ä¸ª
- **äººç±»**: 41ä¸ª  
- **å¦–é­”**: 23ä¸ª

### åŠ¿åŠ›åˆ†å¸ƒ
- **å–ç»å›¢é˜Ÿ**: 5ä¸ª
- **ä½›æ•™**: 7ä¸ª
- **å¤©åº­**: 2ä¸ª
- **å¦–é­”**: 23ä¸ª
- **å…¶ä»–**: 112ä¸ª

### èƒ½åŠ›åˆ†å¸ƒ
- **é«˜èƒ½åŠ›** (80+): 35ä¸ª
- **ä¸­ç­‰èƒ½åŠ›** (50-79): 104ä¸ª
- **ä½èƒ½åŠ›** (<50): 10ä¸ª

## æŠ€æœ¯ç‰¹æ€§

### æ€§èƒ½ä¼˜åŒ–
- **æ•°æ®ç¼“å­˜**: 5åˆ†é’Ÿç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤æ–‡ä»¶è¯»å–
- **æ‰¹é‡å¤„ç†**: ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ–‡ä»¶ï¼Œå‡å°‘I/Oæ“ä½œ
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯æ•è·å’Œæ¢å¤æœºåˆ¶
- **è¿›åº¦åé¦ˆ**: å®æ—¶åŠ è½½è¿›åº¦æ˜¾ç¤º

### æ•°æ®å®Œæ•´æ€§
- **æ ¼å¼éªŒè¯**: ä¸¥æ ¼çš„JSONæ ¼å¼éªŒè¯
- **å­—æ®µæ£€æŸ¥**: å¿…éœ€å­—æ®µå­˜åœ¨æ€§éªŒè¯
- **ç±»å‹è½¬æ¢**: å®‰å…¨çš„æ•°æ®ç±»å‹è½¬æ¢
- **é”™è¯¯è®°å½•**: è¯¦ç»†çš„é”™è¯¯æ—¥å¿—è®°å½•

### å¯æ‰©å±•æ€§
- **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„åŠŸèƒ½æ¨¡å—åˆ†ç¦»
- **APIæ ‡å‡†åŒ–**: RESTful APIè®¾è®¡
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰
- **é…ç½®çµæ´»**: å¯é…ç½®çš„æ•°æ®è·¯å¾„å’Œå‚æ•°

## å¯åŠ¨æ–¹å¼

### æ–¹æ³•1: åˆ†åˆ«å¯åŠ¨
```bash
# å¯åŠ¨æ•°æ®æœåŠ¡å™¨
cd src/server
npm install
npm start

# å¯åŠ¨å‰ç«¯ (æ–°ç»ˆç«¯)
npm run dev
```

### æ–¹æ³•2: ä¸€é”®å¯åŠ¨
```bash
# å®‰è£…ä¾èµ–
npm run install:server

# åŒæ—¶å¯åŠ¨å‰åç«¯
npm run start:all
```

### æ–¹æ³•3: ä½¿ç”¨è„šæœ¬
```bash
# Windowsæ‰¹å¤„ç†è„šæœ¬
scripts/start-with-server.bat
```

## ä¸‹ä¸€æ­¥è®¡åˆ’

### 1. æ•°æ®æ˜ å°„ç®—æ³• (ä¼˜å…ˆçº§: é«˜)
- å®ç°åŸºäºé‡è¦æ€§çš„3Dä½ç½®åˆ†é…
- è§’è‰²å…³ç³»çš„è¿çº¿å¯è§†åŒ–
- åŠ¨æ€çš„é¢œè‰²å’Œå¤§å°æ˜ å°„

### 2. å®æ—¶æ•°æ®åŒæ­¥ (ä¼˜å…ˆçº§: ä¸­)
- WebSocketå®æ—¶é€šä¿¡
- æ•°æ®å˜æ›´çš„å®æ—¶æ¨é€
- å‰ç«¯çŠ¶æ€çš„è‡ªåŠ¨æ›´æ–°

### 3. æ•°æ®ç¼–è¾‘åŠŸèƒ½ (ä¼˜å…ˆçº§: ä¸­)
- åœ¨çº¿ç¼–è¾‘è§’è‰²ä¿¡æ¯
- æ•°æ®éªŒè¯å’Œä¿å­˜
- æ“ä½œå†å²å’Œæ’¤é”€åŠŸèƒ½

### 4. æ€§èƒ½ä¼˜åŒ– (ä¼˜å…ˆçº§: ä½)
- è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–
- æ•°æ®åˆ†é¡µåŠ è½½
- å†…å­˜ä½¿ç”¨ä¼˜åŒ–

## æˆæœå±•ç¤º

### æ•°æ®åŠ è½½æˆåŠŸ
- âœ… 149ä¸ªè¥¿æ¸¸è®°è§’è‰²å®Œæ•´åŠ è½½
- âœ… 97ä¸ªåˆ«åæ•°æ®æ­£ç¡®å…³è”
- âœ… å®Œæ•´çš„è§’è‰²å±æ€§å’Œå…ƒæ•°æ®
- âœ… æ™ºèƒ½çš„å¯è§†åŒ–é…ç½®ç”Ÿæˆ

### ç³»ç»Ÿæ¶æ„å®Œå–„
- âœ… ç¨³å®šçš„åç«¯æ•°æ®æœåŠ¡
- âœ… é«˜æ•ˆçš„å‰åç«¯é€šä¿¡
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†æœºåˆ¶
- âœ… çµæ´»çš„é…ç½®å’Œæ‰©å±•èƒ½åŠ›

### ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- âœ… ç›´è§‚çš„Dashboardç•Œé¢
- âœ… å®æ—¶çš„åŠ è½½è¿›åº¦æ˜¾ç¤º
- âœ… æ¸…æ™°çš„é”™è¯¯æç¤ºä¿¡æ¯
- âœ… ä¾¿æ·çš„ä¸€é”®å¯åŠ¨æ–¹å¼

è¿™ä¸ªçœŸå®æ•°æ®åŠ è½½ç³»ç»Ÿä¸ºè¥¿æ¸¸è®°3Då¯è§†åŒ–é¡¹ç›®å¥ å®šäº†åšå®çš„æ•°æ®åŸºç¡€ï¼Œå®ç°äº†ä»é™æ€JSONæ–‡ä»¶åˆ°åŠ¨æ€3Dæ˜Ÿçƒçš„å®Œæ•´æ•°æ®æµè½¬æ¢ï¼ğŸ­âœ¨
