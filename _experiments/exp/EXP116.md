# EXP116: 局部视图界面设计与实现计划

## 时间
2025-06-18

## 对话背景
用户要求设计新的局部视图界面：点击角色数据点进入局部视图，左边显示角色球体，右边显示信息面板，保留返回按钮，星空背景不变但隐藏其他元素。

## 方案选择

### 最终确定方案
- **主方案**: 方案B - 独立场景方案
- **视图切换**: 阶段1使用直接切换，阶段2添加缩放动画
- **相机位置**: 阶段1使用固定最佳角度，阶段2添加用户控制
- **信息面板**: 基础+扩展信息
- **返回按钮**: 左上角固定位置
- **其他角色**: 完全隐藏

### 分阶段实现策略
**阶段1 (MVP)**: 核心功能实现
**阶段2 (增强)**: 动画效果和高级控制

## 详细TODO计划

### 🎯 阶段1: 核心功能实现

#### 1. 状态管理扩展
- [x] 1.1 扩展useGalaxyStore添加视图状态
  - [x] viewMode: 'galaxy' | 'detail'
  - [x] selectedCharacter: CharacterData | null
  - [x] detailViewCameraPosition: Vector3
  - [x] 相关setter方法

#### 2. 独立详情场景组件
- [x] 2.1 创建CharacterDetailScene.tsx
  - [x] 独立的Canvas和3D场景
  - [x] 单个角色球体渲染
  - [x] 固定的最佳观察相机角度
  - [x] 星空背景保持

#### 3. 详情视图UI布局
- [x] 3.1 创建CharacterDetailView.tsx
  - [x] CSS Grid左右分屏布局 (1fr 400px)
  - [x] 左侧3D场景容器
  - [x] 右侧信息面板容器

#### 4. 信息面板组件
- [x] 4.1 创建CharacterDetailPanel.tsx
  - [x] 基础信息显示 (姓名、描述、属性)
  - [x] 扩展信息显示 (别名、详细属性)
  - [x] 响应式设计

#### 5. 返回按钮组件
- [x] 5.1 创建DetailViewBackButton.tsx
  - [x] 左上角固定定位
  - [x] 点击返回全局视图
  - [x] 简洁的图标设计

#### 6. 点击交互逻辑
- [x] 6.1 扩展useCharacterInteraction
  - [x] 添加点击检测逻辑
  - [x] 触发进入详情视图
  - [x] 设置选中角色状态

#### 7. 主应用集成
- [x] 7.1 修改App.tsx
  - [x] 条件渲染全局视图/详情视图
  - [x] 状态切换逻辑
  - [x] 路由管理 (可选)

### 🎯 阶段2: 增强功能 (后续实现)

#### 8. 动画过渡系统
- [ ] 8.1 缩放动画过渡
- [ ] 8.2 场景切换动画
- [ ] 8.3 相机位置插值动画

#### 9. 用户相机控制
- [ ] 9.1 详情视图相机控制UI
- [ ] 9.2 相机位置状态管理
- [ ] 9.3 预设视角快捷按钮

## 技术实现要点

### 核心架构
```
App.tsx
├── viewMode === 'galaxy' → GalaxyScene
└── viewMode === 'detail' → CharacterDetailView
    ├── CharacterDetailScene (左侧3D)
    ├── CharacterDetailPanel (右侧信息)
    └── DetailViewBackButton (返回按钮)
```

### 状态流转
```
全局视图 → 点击角色 → 设置selectedCharacter → 切换viewMode → 详情视图
详情视图 → 点击返回 → 清除selectedCharacter → 切换viewMode → 全局视图
```

### CSS布局结构
```css
.character-detail-view {
  display: grid;
  grid-template-columns: 1fr 400px;
  height: 100vh;
}

.detail-scene-container {
  position: relative;
}

.detail-panel-container {
  background: rgba(0, 0, 0, 0.8);
  padding: 20px;
}

.back-button {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1000;
}
```

## 风险评估

### 低风险项
- 状态管理扩展 (基于现有架构)
- UI布局实现 (标准CSS Grid)
- 返回按钮功能 (简单状态切换)

### 中风险项
- 独立场景组件 (需要正确的Three.js设置)
- 点击交互集成 (需要与现有系统整合)
- 信息面板数据绑定 (需要正确的数据流)

### 注意事项
- 确保两个场景的渲染器不冲突
- 保持星空背景的一致性
- 优化性能，避免双重渲染

## 开发顺序
1. 状态管理 → 2. 基础UI布局 → 3. 独立场景 → 4. 信息面板 → 5. 交互逻辑 → 6. 集成测试

## 成功标准
- [x] 点击角色能正确进入详情视图
- [x] 详情视图显示正确的角色信息
- [x] 返回按钮能正确回到全局视图
- [x] 性能无明显下降
- [x] UI布局在不同屏幕尺寸下正常显示

## 阶段1实施完成状态

### ✅ 已完成的功能
1. **状态管理扩展** - useGalaxyStore添加了视图状态管理
2. **独立详情场景** - CharacterDetailScene.tsx创建完成
3. **UI布局组件** - CharacterDetailView.tsx实现左右分屏
4. **信息面板** - CharacterDetailPanel.tsx显示完整角色信息
5. **返回按钮** - DetailViewBackButton.tsx左上角固定定位
6. **点击交互** - useCharacterInteraction扩展了点击检测
7. **主应用集成** - App.tsx支持条件渲染视图切换

### 🔧 技术实现亮点
- **类型安全**: 扩展CharacterData类型支持位置信息
- **组件分离**: 独立场景避免渲染冲突
- **响应式设计**: CSS Grid布局适配不同屏幕
- **状态管理**: 清晰的视图状态流转
- **性能优化**: 条件渲染减少不必要的组件

### 🚀 开发服务器状态
- 端口: http://localhost:3001/
- 编译状态: ✅ 成功
- 错误修复: StarField导入路径已修正

### 📋 下一步计划
进入阶段2增强功能开发：
- 缩放动画过渡效果
- 用户可调整相机控制
- 更丰富的交互功能
