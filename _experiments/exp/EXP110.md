# EXP110: 角色信息卡片完整设计规划与实现方案

## 时间
2025-06-18

## 设计目标

### 用户体验目标
- **即时反馈**: 鼠标悬浮立即显示详细信息，无延迟
- **信息丰富**: 展示角色的完整属性和背景信息
- **视觉协调**: 与3D场景和角色颜色保持一致的设计风格
- **交互流畅**: 不干扰3D场景的正常交互操作

### 技术实现目标
- **性能优化**: 卡片渲染不影响3D场景性能
- **兼容性强**: 支持不同设备和屏幕尺寸
- **维护性好**: 组件化设计，易于扩展和修改
- **稳定可靠**: 避免渲染冲突，确保功能稳定

## 详细设计规范

### 🎨 视觉设计规范

#### 卡片基础样式
- **尺寸规格**: 280px(宽) × 200px(高) - 桌面端标准尺寸
- **背景设计**: `rgba(0, 0, 0, 0.9)` - 深色半透明，确保文字清晰可读
- **边框样式**: `2px solid ${角色颜色}` - 使用角色的主题颜色作为边框
- **圆角设计**: `12px` - 现代化的圆角设计，柔和美观
- **层级管理**: `z-index: 10000` - 确保卡片显示在最上层

#### 阴影和特效
- **基础阴影**: `0 8px 32px rgba(0, 0, 0, 0.8)` - 提供深度感
- **发光效果**: `0 0 20px ${角色颜色}40` - 角色颜色的发光边框
- **毛玻璃效果**: `backdrop-filter: blur(10px)` - 现代化的背景模糊
- **过渡动画**: 显示/隐藏时的平滑过渡效果

#### 字体和颜色系统
- **主标题**: 18px, 粗体, 角色主题颜色
- **副标题**: 12px, 斜体, #aaa灰色
- **正文内容**: 14px, 常规, #ffffff白色
- **标签文字**: 12px, 常规, #888灰色
- **数值高亮**: 使用角色颜色或状态颜色

### 📋 信息架构设计

#### 1. 标题区域（Header Section）
**占比**: 25% 卡片高度
**内容结构**:
```
┌─────────────────────────────────┐
│ 孙悟空 (别名)                    │ ← 角色名称 + 别名标识
│ sun wu kong                     │ ← 拼音显示
└─────────────────────────────────┘
```

**样式规范**:
- 角色名称：18px粗体，使用角色主题颜色
- 别名标识：12px，灰色，括号包围
- 拼音显示：12px斜体，浅灰色
- 底部分割线：使用角色颜色的40%透明度

#### 2. 基本信息区域（Basic Info Section）
**占比**: 35% 卡片高度
**内容结构**:
```
┌─────────────────────────────────┐
│ 类别：主角团队                   │
│ 阵营：正义                      │
│ 类型：神通广大                   │
└─────────────────────────────────┘
```

**数据映射**:
- **类别映射**:
  - `protagonist` → 主角团队
  - `deity` → 神仙
  - `demon` → 妖魔
  - `dragon` → 龙族
  - `buddhist` → 佛教
  - `celestial` → 天庭
  - `underworld` → 地府
  - `human` → 人类

- **阵营分类**: 正义/邪恶/中立/复杂
- **类型描述**: 角色的具体类型和特征

#### 3. 数值信息区域（Stats Section）
**占比**: 30% 卡片高度
**内容结构**:
```
┌─────────────────────────────────┐
│ 排名：#1                        │ ← 金色显示
│ 能力：95 (至尊)                 │ ← 角色颜色
│ 影响力：98                      │ ← 角色颜色
└─────────────────────────────────┘
```

**数值分级系统**:
- **排名颜色**:
  - 前10名：`#ffd700` (金色)
  - 前50名：`#ff6b6b` (红色)
  - 其他：`#4ecdc4` (蓝色)

- **能力等级**:
  - 90-100：至尊 (`#ffd700`)
  - 80-89：极强 (`#ff6b6b`)
  - 70-79：很强 (`#4ecdc4`)
  - 60-69：较强 (`#45b7d1`)
  - 50-59：中等 (`#96ceb4`)
  - 40-49：较弱 (`#feca57`)
  - 0-39：弱 (`#ff9ff3`)

#### 4. 特殊信息区域（Special Info Section）
**占比**: 10% 卡片高度
**内容结构**:
```
┌─────────────────────────────────┐
│ 原角色：齐天大圣                 │ ← 仅别名角色显示
└─────────────────────────────────┘
```

### 🎯 交互行为设计

#### 显示触发机制
- **触发条件**: 鼠标悬浮在角色球体上
- **显示延迟**: 0ms - 立即显示，提供即时反馈
- **显示动画**: 淡入效果，持续150ms
- **位置计算**: 基于鼠标位置 + 15px偏移

#### 位置智能算法
```typescript
// 智能定位算法伪代码
function calculateOptimalPosition(mouseX, mouseY, cardWidth, cardHeight) {
  const offset = 15
  let left = mouseX + offset
  let top = mouseY + offset
  
  // 右边界检测
  if (left + cardWidth > window.innerWidth) {
    left = mouseX - cardWidth - offset
  }
  
  // 下边界检测
  if (top + cardHeight > window.innerHeight) {
    top = mouseY - cardHeight - offset
  }
  
  // 左边界保护
  if (left < offset) {
    left = offset
  }
  
  // 上边界保护
  if (top < offset) {
    top = offset
  }
  
  return { left, top }
}
```

#### 隐藏触发机制
- **触发条件**: 鼠标离开角色球体
- **隐藏延迟**: 0ms - 立即隐藏
- **隐藏动画**: 淡出效果，持续100ms
- **状态清理**: 清除全局状态中的角色信息

#### 防干扰设计
- **鼠标事件**: `pointerEvents: 'none'` - 卡片不阻挡鼠标事件
- **层级管理**: 确保卡片在最上层但不影响3D交互
- **性能优化**: 避免频繁的DOM操作和重绘

### 📱 响应式适配方案

#### 桌面端（>1024px）
- **卡片尺寸**: 280px × 200px
- **字体大小**: 标题18px，正文14px，辅助12px
- **信息完整度**: 显示所有信息层级
- **特效支持**: 完整的阴影和毛玻璃效果

#### 平板端（768px-1024px）
- **卡片尺寸**: 260px × 190px
- **字体大小**: 标题16px，正文13px，辅助11px
- **信息完整度**: 保持所有信息，适当压缩间距
- **特效支持**: 简化阴影效果，保留毛玻璃

#### 移动端（<768px）
- **卡片尺寸**: 240px × 180px
- **字体大小**: 标题14px，正文12px，辅助10px
- **信息完整度**: 优先显示核心信息，简化次要信息
- **特效支持**: 最小化特效，优先性能

### 🔧 技术实现方案

#### 组件架构
```
CharacterInfoOverlay (主组件)
├── HeaderSection (标题区域)
├── BasicInfoSection (基本信息)
├── StatsSection (数值信息)
└── SpecialInfoSection (特殊信息)
```

#### 状态管理集成
```typescript
// 全局状态接口
interface CharacterInfoState {
  hoveredCharacter: CharacterData | null
  mousePosition: Vector2
  showInfoCard: boolean
}

// 组件使用方式
const { hoveredCharacter, mousePosition, showInfoCard } = useCharacterInfoStore()
```

#### 性能优化策略
- **条件渲染**: 只在需要时渲染卡片组件
- **状态缓存**: 利用React的memo和useMemo优化
- **事件节流**: 控制位置更新频率
- **内存管理**: 及时清理不需要的状态和事件监听

### 🧪 测试验证方案

#### 功能测试清单
- [ ] 鼠标悬浮正确触发卡片显示
- [ ] 卡片信息内容准确完整
- [ ] 位置跟随鼠标移动流畅
- [ ] 边界检测和位置调整正确
- [ ] 鼠标离开正确隐藏卡片
- [ ] 不同视角下功能正常
- [ ] 不干扰3D场景交互

#### 兼容性测试
- [ ] 桌面端Chrome/Firefox/Safari
- [ ] 平板端iPad/Android平板
- [ ] 移动端iPhone/Android手机
- [ ] 不同屏幕分辨率适配
- [ ] 高DPI屏幕显示效果

#### 性能测试
- [ ] 卡片显示/隐藏响应时间
- [ ] 大量角色场景下的性能表现
- [ ] 内存使用情况监控
- [ ] 3D渲染性能影响评估

## 实现优先级

### P0 - 核心功能（必须实现）
1. 基础卡片显示和隐藏
2. 核心信息展示（名称、类别、排名、能力）
3. 智能位置算法
4. 基础样式和视觉效果

### P1 - 重要功能（优先实现）
1. 完整信息层级展示
2. 响应式适配
3. 颜色和等级系统
4. 别名角色特殊处理

### P2 - 增强功能（后续实现）
1. 显示/隐藏动画效果
2. 高级视觉特效
3. 自定义主题支持
4. 可配置信息显示

这个设计规划为角色信息卡片功能提供了完整的实现指导，确保功能的完整性、可用性和可维护性。
