# EXP169 - 修复空银河系界面鼠标悬浮检测失效问题

## 问题描述
用户反馈空银河系界面有时候鼠标悬浮到81难球体上面检测效果会失效，得刷新界面才重新能够点击球体或者触发脉冲效果。

## 问题分析

### 根本原因
通过代码分析发现，JourneyPoints组件的事件监听器因为状态依赖而频繁重新绑定，导致检测失效：

1. **事件监听器重复绑定问题**：
   - useEffect依赖数组包含了`hoveredIndex`和`selectedIndex`
   - 每次悬浮状态改变都会重新绑定事件监听器
   - 频繁的绑定/解绑导致性能问题和失效

2. **闭包捕获旧值问题**：
   - 事件处理函数中直接使用状态变量
   - 在事件监听器绑定时被"捕获"，使用的是旧值

## 解决方案

### 核心修复策略
使用useRef + useCallback的组合方案：

1. **添加ref存储最新状态**
2. **同步ref和state**  
3. **使用useCallback包装事件处理函数**
4. **修复useEffect依赖数组**

### 具体修改内容

1. **添加状态ref**：
   ```typescript
   const hoveredIndexRef = useRef<number | null>(null)
   const selectedIndexRef = useRef<number | null>(null)
   ```

2. **重构事件处理函数**：
   - 使用useCallback包装所有事件处理函数
   - 通过ref获取最新状态，避免闭包问题

3. **修复useEffect依赖**：
   - 移除状态变量依赖，只保留真正需要的依赖
   - 添加调试日志便于追踪

## 预期效果
- 事件监听器稳定，不会频繁重新绑定
- 事件处理函数总是能获取最新状态
- 彻底解决鼠标悬浮检测失效问题

## 技术要点
- useCallback确保函数引用稳定
- useRef存储可变值，不触发重新渲染
- 事件监听器最佳实践：稳定的依赖数组

修复已完成，建议测试悬浮交互的稳定性。
