# 项目管理与工作流
- 项目根目录D:\codee\xiyouji-rela-map已统一使用pnpm workspace管理包，src\server已纳入workspace统一管理，不再使用npm
- 用户偏好在单独的文件夹（如'rebuild'）中重建代码，而不是就地修改，并希望在选择前看到多个解决方案选项
- 用户习惯使用_experiments目录进行项目进度跟踪、工作接力和交接，这是其项目管理流程的重要组成部分
- 用户偏好从TODO列表开始进行任务组织，并偏好实施长期计划，表明倾向于战略性开发方法
- 用户偏好在开始复杂工作前先创建详细的任务列表进行规划和组织
- 用户偏好的代码管理工作流程：暂存变动 → review文件 → 提交commit → 推送 → 为重大更新创建版本tag
- 成功创建v1.2.1版本tag：UI布局优化与模型特效调试修复版本，解决了左上角按钮重叠、数据管理按钮位置、ModelEffectGUI参数响应等关键问题
- 用户指出项目缺少开源协议配置，需要在package.json或LICENSE文件中明确指定开源许可证
- 用户指出实现不符合最初要求，需要重新理解用户的核心需求而不是仅仅解决技术限制问题

# 技术偏好
- 用户偏好在JavaScript/TypeScript项目中使用pnpm作为包管理器，直接从根目录运行'pnpm dev'启动项目
- 用户偏好使用中文作为代码注释、文档和记忆的主要语言
- 用户偏好snake_case（多下划线）命名约定作为正确格式
- 用户偏好使用Cloudflare Tunnel而不是ngrok进行外部访问，并在vite.config.js中配置allowedHosts允许所有主机访问
- 用户偏好移除WebGPU功能，因为它无法正常工作，并希望恢复到原始的仅WebGL实现
- 用户偏好后端服务具有端口自动检测和适应性功能，而不是硬编码固定端口
- 用户偏好在Three.js项目中使用BVH优化技术（three-mesh-bvh库）来提升性能

# 数据管理
- 项目数据存储已完全从JSON文件迁移为SQLite数据库，性能提升14倍
- 数据库文件位置：data/characters.db，包含482条记录（150角色+332别名）
- 原始JSON文件已备份到docs/data/JSON目录，作为历史参考保留
- 数据服务器已统一为SQLite版本：src/server/dataServer.js，支持高级搜索API
- 数据库字段已完成汉化处理：主角、神仙、妖魔、龙族等中文分类
- 后端API支持中英文兼容的角色类型映射和颜色配置
- 用户需要将events.db数据库中的真实数据集成到空银河系界面的81个取经路径点中，实现数据驱动的可视化
- 用户偏好在事件可视化中显示事件描述、相关角色、寓意等有意义的信息，而不是战力、影响力、综合排名等数值数据
- 成功重构事件信息卡片系统：创建EventInfoCard/EventInfoOverlay组件和useEventInfoStore状态管理，将空银河系页面从显示无意义的角色数据（战力、影响力、排名）改为显示有用的事件信息（事件描述、相关角色、象征意义、文化内涵），并推送到feature/event-info-cards-20250126分支

# 界面设计
- 用户偏好具有全面控制参数的GUI界面，用于微调效果和配置，但GUI控制面板应默认折叠到最小状态
- 用户偏好简洁的界面设计，不需要框选中的按钮，并希望移除显示端口和角色数量的标签
- 用户偏好在3D可视化中添加交互功能：鼠标悬浮时显示描边泛光效果和基于JSON数据的信息卡片
- 优化左上角按钮布局：将PageSwitcher按钮从left:10px移至left:200px，避免与ModelQuickAccess重叠
- 解决数据管理按钮与模型库按钮重叠问题：将DataDashboard触发按钮和面板从左上角移动到左下角(bottom:20px)
- 修复ModelEffectGUI位置异常和参数响应问题：修复CSS语法错误(right:'400 px'→'20px')，更正onChange回调使用最新config而非guiConfig
- 用户偏好为可视化效果创建GUI调试面板，方便实时调整参数和效果
- 用户需要在空银河系界面添加点击点进入局部视图的功能，要求复用之前已实现的局部视图系统

# 3D可视化设置
- 用户在网页浏览器中运行3D可视化时优先考虑低端计算机的性能优化，必要时优先考虑流畅性能而不是视觉质量
- 用户偏好在银河系可视化项目中禁用自动性能级别调整，只保留手动配置选择
- 用户偏好星球发光强度默认设置为0.2，Character Controls默认参数：透明度1.0，全局大小0.6，发光强度0.7
- 成功实施多InstancedMesh颜色分组方案，实现基于角色类型的9种颜色映射，支持482个角色球体的高性能多颜色渲染
- 用户偏好3D模型和球体特效是独立组件，模型大小应合适，加载状态应隐藏球体
- 模型检测系统已实现自动化：scripts/build/generate-model-index.js动态扫描public/models目录
- 模型索引文件public/models/index.json自动生成，包含白龙马在内的11个GLB模型
- 用户要求在新界面中使用单条螺旋线而不是多个螺旋分布的点，这与西游记的81难概念相关
- 成功在西游记项目的空银河系页面中实现了九九八十一个点的单螺旋线分布，使用阿基米德螺旋线算法从外到内展示取经路径，颜色从蓝色渐变到金色，集成了浮动和脉冲动画效果
- 成功创建了"Spiral Controls"GUI面板，为西游记取经路径螺旋线提供实时调试控制，包含8个参数分组、4个内置预设、用户自定义保存功能，集成到GalaxyStore状态管理，实现参数变化的实时响应
- 成功为西游记取经路径球体添加了丰富的动画效果，扩展JourneyConfig添加8个新参数，实现浮动+脉冲+大小变化三层动画叠加，GUI面板重构为5个分组15个参数，新增"动感球体"预设展示最丰富的动画效果
- 用户偏好在西游记项目新界面中将球体从当前螺旋分布改为沿着伪银河系悬臂螺旋分布
- 成功将西游记取经路径从阿基米德螺旋升级为银河系悬臂对数螺旋分布，新增armTightness和armIndex参数控制，创建"银河悬臂"预设，实现与银河系背景的视觉统一
- 用户偏好在3D可视化项目中添加自由视角控制功能：左键旋转、中键缩放、右键平移，并在Controls面板中提供开关按钮，默认关闭状态

# 局部视图设计
- 用户偏好局部视图界面设计：点击角色数据点进入局部视图，左边显示角色球体，右边显示信息面板，包含返回按钮
- 用户选择独立场景方案(方案B) + 缩放动画过渡 + 用户可调整相机控制 + 基础扩展信息面板 + 左上角返回按钮 + 完全隐藏其他角色
- 用户偏好在局部视图中根据角色名称加载对应的.glb模型文件，实现线框和点特效渲染
- 用户偏好选择方案B：完整特效系统 + 高级GUI，而不是基础实现或完全重构方案
- 用户偏好模型特效调试GUI面板默认完全收起状态，所有文件夹都应该默认关闭以减少界面干扰
- 用户偏好在事件局部视图中显示三维关系图谱，展示主要人物的几个点，而不是单个事件球体

# 启动项目
- 使用 pnpm run start:all 一键启动所有前端和后端服务